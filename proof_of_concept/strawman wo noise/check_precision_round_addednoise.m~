%setup
clear;
close all;

%add code database
mydir  = pwd;
idcs   = strfind(mydir,filesep);
newdir = mydir(1:idcs(end-1)-1);
addpath(newdir + "/reconstruction_simulation_networks/") 

%define parameters
num_nodes=30; %number_nodes
n_incoming=5; %number incoming nodes (sparsity)
delta_t=0.001;  %fine simulation tscale
res=0.01;  %coarse reconstruction t-scale
initial="random"; %specify initial conditions
T=100;  %how many timesteps are evaluated
couplings=[1];  %coupling strength 
num_simulations=1;  %how many simulations to perform 

%noise
sigma = 10^-1;

%where to save data
save_string=sprintf('simulations/data_linear_T%d_dt%0.0e_Nnodes%d_Nincoming%d_sigma%0.0e',...
    T,delta_t, num_nodes, n_incoming, sigma);
Ntotal=50;
%% without rounding or noise

all_AUCS=zeros(Ntotal,num_nodes);
for isim=1:Ntotal
    load(sprintf(strcat(save_string, "w_noise_I%d.mat"), isim));
    [AUCs]=reconstruction_2p_approx(x_tau_all,...
                                   dt_x_all, adjacency,num_nodes);
    all_AUCS(isim,:)=AUCs;
end

save(sprintf("simulations/summary_2palg_precisionfull_S%0.0e.mat", sigma),  'all_AUCS');

%% with rounding

all_AUCS=zeros(Ntotal,num_nodes);
for isim=1:Ntotal
    load(sprintf(strcat(save_string, "w_noise_I%d.mat"), isim));
    [AUCs]=reconstruction_2p_approx(round(x_tau_all,3),...
                                   round(dt_x_all,3), adjacency,num_nodes);
    all_AUCS(isim,:)=AUCs;
end

save("simulations/summary_2palg_precisionround.mat",  'all_AUCS');

%% with additional noise

all_AUCS=zeros(Ntotal,num_nodes);
for isim=1:Ntotal
    load(sprintf(strcat(save_string, "w_noise_I%d.mat"), isim));
    [AUCs]=reconstruction_2p_approx(x_tau_all + 1/3*sigma*randn(size(x_tau_all)),... 
                                   dt_x_all+ 1/3*sigma*randn(size(dt_x_all)),...
                                   adjacency,num_nodes);
    all_AUCS(isim,:)=AUCs;
end

save("simulations/summary_2palg_precisionaddnoise.mat",  'all_AUCS');

%% bar/scatter plot


%load wo loss of precision
load("simulations/summary_2palg_precisionfull.mat")
auc_wonoise = reshape(all_AUCS, Ntotal*num_nodes,1);
%load with rounding
load("simulations/summary_2palg_precisionround.mat")
auc_round = reshape(all_AUCS, Ntotal*num_nodes,1);
%load with additional noise
load("simulations/summary_2palg_precisionaddnoise.mat")
auc_addnoise = reshape(all_AUCS, Ntotal*num_nodes,1);

xdata1 = ones(Ntotal*num_nodes,1) + randn(Ntotal*num_nodes,1)*0.1;
xdata2 = ones(Ntotal*num_nodes,1)*2 + randn(Ntotal*num_nodes,1)*0.1;
xdata3 = ones(Ntotal*num_nodes,1)*3 + randn(Ntotal*num_nodes,1)*0.1;

figure('Name', 'BarScatter_AU')
scatter(xdata1, auc_wonoise)
hold on
scatter(1, mean(auc_wonoise), "ks", 'markerfacecolor', 'k')
hold on
scatter(xdata2, auc_round)
hold on
scatter(2, mean(auc_round), "ks", 'markerfacecolor', 'k')
hold on
scatter(xdata3, auc_addnoise)
hold on
scatter(3, mean(auc_addnoise), "ks", 'markerfacecolor', 'k')
ylabel("AUC")
%xticks([1,2]);
%xticklabels({"w\\o noise", "w\ noise"})